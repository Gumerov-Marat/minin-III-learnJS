!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=0},function(t,e,n){"use strict";n.r(e);class s{constructor(t){this.$el=document.getElementById(t),this.init()}init(){}onShow(){}onHide(){}hide(){this.$el.classList.add("hide"),this.onHide()}show(){this.$el.classList.remove("hide"),this.onShow()}}function i(){localStorage.setItem("visited",JSON.stringify(!0)),this.hide()}function r(t){if(t.preventDefault(),t.target.classList.contains("tab")){Array.from(this.$el.querySelectorAll(".tab")).forEach(t=>{t.classList.remove("active")}),t.target.classList.add("active");const e=this.tabs.find(e=>e.name===t.target.dataset.name);this.tabs.forEach(t=>t.component.hide()),e.component.show()}}class o{constructor(t,e){this.form=t,this.controls=e}value(){const t={};return Object.keys(this.controls).forEach(e=>{t[e]=this.form[e].value}),t}clear(){Object.keys(this.controls).forEach(t=>{this.form[t].value=""})}isValid(){let t=!0;return Object.keys(this.controls).forEach(e=>{const n=this.controls[e];let s=!0;n.forEach(t=>{s=t(this.form[e].value)&&s}),s?a(this.form[e]):function(t){a(t);t.classList.add("invalid"),t.insertAdjacentHTML("afterend",'<p class="validation-error">Введите корректное значение</p>')}(this.form[e]),t=t&&s}),t}}function a(t){t.classList.remove("invalid"),t.nextSibling&&t.closest(".form-control").removeChild(t.nextSibling)}class l{static required(t=""){return t&&t.trim()}static minLength(t){return e=>e.length>=t}}async function c(t){const e=await fetch(t);return await e.json()}const d=new class{constructor(t){this.url=t}async createPost(t){try{return c(new Request(this.url+"/posts.json",{method:"post",body:JSON.stringify(t)}))}catch(t){console.error(t)}}async fetchPosts(){try{return c(new Request(this.url+"/posts.json",{method:"get"}))}catch(t){console.error(t)}}async fetchPostById(t){try{return c(new Request(`${this.url}/posts/${t}.json`,{method:"get"}))}catch(t){console.error(t)}}}("https://g4mf-page.firebaseio.com/");async function u(t){if(t.preventDefault(),this.form.isValid()){const t={type:this.$el.type.value,date:(new Date).toLocaleDateString(),...this.form.value()};await d.createPost(t),this.form.clear(),alert("Запись создана в базе данных")}}function h(t,e={}){const n="news"===t.type?'<li class="tag tag-blue tag-rounded">Новость</li>':'<li class="tag tag-rounded">Заметка</li>',s=(JSON.parse(localStorage.getItem("favorites"))||[]).find(e=>e.id===t.id)?`<button class="button-round button-small button-danger" data-id="${t.id}" data-title="${t.title}">Удалить</button>`:`<button class="button-round button-small button-primary" data-id="${t.id}" data-title="${t.title}">Сохранить</button>`;return`\n    <div class="panel">\n      <div class="panel-head">\n        <p class="panel-title">${t.title}</p>\n        <ul class="tags">\n          ${n}\n        </ul>\n      </div>\n      <div class="panel-body">\n        <p class="multi-line">${t.fulltext}</p>\n      </div>\n      <div class="panel-footer w-panel-footer">\n        <small>${t.date}</small>\n        ${e.withButton?s:""}\n      </div>\n    </div>\n  `}async function f(t){if(t.preventDefault(),t.target.classList.contains("js-link")){const e=t.target.dataset.id;this.$el.innerHTML="",this.loader.show();const n=await d.fetchPostById(e);this.loader.hide(),this.$el.insertAdjacentHTML("afterbegin",h(n,{withButton:!1}))}}function p(t){const e=t.target,n=e.dataset.id,s=e.dataset.title;if(n){let t=JSON.parse(localStorage.getItem("favorites"))||[];t.find(t=>t.id===n)?(e.textContent="Сохранить",e.classList.add("button-primary"),e.classList.remove("button-danger"),t=t.filter(t=>t.id!==n)):(e.classList.remove("button-primary"),e.classList.add("button-danger"),e.textContent="Удалить",t.push({id:n,title:s})),localStorage.setItem("favorites",JSON.stringify(t))}}n(0),new class extends s{constructor(t){super(t)}init(){localStorage.getItem("visited")&&this.hide();this.$el.querySelector(".js-header-start").addEventListener("click",i.bind(this))}}("header");const m=new class extends s{constructor(t){super(t),this.tabs=[]}init(){this.$el.addEventListener("click",r.bind(this))}registerTabs(t){this.tabs=t}}("navigation"),b=new class extends s{constructor(t){super(t)}}("loader"),g=new class extends s{constructor(t,{loader:e}){super(t),this.loader=e}init(){this.$el.addEventListener("click",p.bind(this))}async onShow(){this.loader.show();const t=await d.fetchPosts(),e=class{static fbObjectToArray(t){return Object.keys(t).map(e=>{const n=t[e];return n.id=e,n})}}.fbObjectToArray(t).map(t=>h(t,{withButton:!0}));this.loader.hide(),this.$el.insertAdjacentHTML("afterbegin",e.join(" "))}onHide(){this.$el.innerHTML=""}}("posts",{loader:b}),v=new class extends s{constructor(t){super(t)}init(){this.$el.addEventListener("submit",u.bind(this)),this.form=new o(this.$el,{title:[l.required],fulltext:[l.required,l.minLength(10)]})}}("create"),y=new class extends s{constructor(t,e){super(t),this.loader=e.loader}init(){this.$el.addEventListener("click",f.bind(this))}onShow(){const t=function(t=[]){if(t&&t.length)return`\n      <ul>\n        ${t.map(t=>`<li><a href="#" class="js-link" data-id="${t.id}">${t.title}</a></li>`).join(" ")}\n      </ul>\n    `;return'<p class="center">Вы пока ничего не добавили</p>'}(JSON.parse(localStorage.getItem("favorites")));this.$el.insertAdjacentHTML("afterbegin",t)}onHide(){this.$el.innerHTML=""}}("favorite");m.registerTabs([{name:"create",component:v},{name:"posts",component:g},{name:"favorite",component:y}])}]);